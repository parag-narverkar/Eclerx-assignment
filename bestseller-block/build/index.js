(()=>{"use strict";var e,o={306:()=>{const e=window.wp.blocks,o=window.wp.element,t=window.wp.blockEditor,r=window.wp.components,s=window.ReactJSXRuntime;(0,e.registerBlockType)("my-block/category-book-selector",{title:"Bestseller Block",category:"widgets",icon:"book",attributes:{selectedCategory:{type:"string",default:""},selectedBookId:{type:"string",default:""},selectedBookTitle:{type:"string",default:""},selectedBookCover:{type:"string",default:""},selectedBookAmazonLink:{type:"string",default:""},selectedBookAuthors:{type:"array",default:[]},blockTitle:{type:"string",default:"Bestsellers"}},edit:e=>{const{attributes:l,setAttributes:a}=e,[n,i]=(0,o.useState)({categories:[],books:[],loadingCategories:!0,loadingBooks:!1,errorCategories:null,errorBooks:null,sortOrder:"desc"}),c=e=>i((o=>({...o,...e})));(0,o.useEffect)((()=>{fetch("https://api.penguinrandomhouse.com/resources/v2/title/domains/PRH.UK/categories?rows=15&catSetId=PW&api_key=7fqge2qgxcdrwqbcgeywwdj2").then((e=>e.json())).then((e=>{e.data?.categories?c({categories:e.data.categories,loadingCategories:!1}):c({loadingCategories:!1,errorCategories:"Failed to load categories"})})).catch((e=>{c({loadingCategories:!1,errorCategories:"Error fetching categories"})}))}),[]),(0,o.useEffect)((()=>{l.selectedCategory&&d(l.selectedCategory,n.sortOrder)}),[l.selectedCategory,n.sortOrder]);const d=(e,o="desc")=>{c({loadingBooks:!0}),fetch(`https://api.penguinrandomhouse.com/resources/v2/title/domains/PRH.UK/works/views/uk-list-display?catUri=${encodeURIComponent(e)}&sort=weeklySales&dir=${o}&api_key=7fqge2qgxcdrwqbcgeywwdj2`).then((e=>e.json())).then((e=>{e.data?.works?c({books:e.data.works,loadingBooks:!1}):c({books:[],loadingBooks:!1,errorBooks:"No books found for this category"})})).catch((e=>{c({books:[],loadingBooks:!1,errorBooks:"Error fetching books"})}))},g=n.categories.map((e=>({label:e.menuText,value:e.catUri}))),k=n.books.map((e=>({value:e.workId,label:e.title})));return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.InspectorControls,{children:(0,s.jsxs)(r.PanelBody,{title:"Category and Books Settings",initialOpen:!0,children:[n.loadingCategories?(0,s.jsx)("p",{children:"Loading categories..."}):n.errorCategories?(0,s.jsx)("p",{children:n.errorCategories}):(0,s.jsx)(r.SelectControl,{label:"Select a Genre",value:l.selectedCategory||"",options:[{label:"Select a category",value:""},...g],onChange:e=>{a({selectedCategory:e}),d(e,n.sortOrder)}}),l.selectedCategory&&n.loadingBooks?(0,s.jsx)("p",{children:"Loading books..."}):l.selectedCategory&&n.errorBooks?(0,s.jsx)("p",{children:n.errorBooks}):l.selectedCategory?(0,s.jsx)(r.SelectControl,{label:"Select a Book",value:l.selectedBookId||"",options:[{label:"Select a book",value:""},...k],onChange:e=>{const o=n.books.find((o=>o.workId===parseInt(e))),t=o?.coverUrls?.large?.coverUrl||"",r=o?.affiliateLinks?.find((e=>"amazon"===e.affiliateType))?.url,s=o?.authors?.map((e=>e.authorDisplay))||[];a({selectedBookId:e,selectedBookTitle:o?.title||"",selectedBookCover:t,selectedBookAmazonLink:r||"",selectedBookAuthors:s})}}):null,(0,s.jsx)(r.SelectControl,{label:"Sort Order",value:n.sortOrder,options:[{label:"Descending (Most Sales First)",value:"desc"},{label:"Ascending (Least Sales First)",value:"asc"}],onChange:e=>{c({sortOrder:e}),l.selectedCategory&&d(l.selectedCategory,e)}})]})}),(0,s.jsxs)("div",{className:"bestsellers-container",children:[(0,s.jsx)(t.RichText,{tagName:"h2",className:"bestsellers-title",value:l.blockTitle||"Bestsellers",onChange:e=>a({blockTitle:e}),placeholder:"Enter block title..."}),l.selectedBookId?(0,s.jsxs)("div",{className:"book-details",children:[(0,s.jsx)("img",{src:l.selectedBookCover||"",alt:l.selectedBookTitle}),(0,s.jsx)("p",{children:l.selectedBookTitle}),l.selectedBookAuthors.length>0?(0,s.jsx)("p",{children:l.selectedBookAuthors.join(", ")}):(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Author(s):"})," Unknown"]}),l.selectedBookAmazonLink?(0,s.jsx)("p",{className:"amazon-button",children:(0,s.jsx)("a",{href:l.selectedBookAmazonLink,target:"_blank",rel:"noopener noreferrer",children:"Buy from Amazon"})}):(0,s.jsx)("p",{children:"No Amazon link available"})]}):(0,s.jsx)("p",{children:"No book selected"})]})]})},save:()=>null,supports:{html:!1},render_callback:"render_bestsellers_block"})}},t={};function r(e){var s=t[e];if(void 0!==s)return s.exports;var l=t[e]={exports:{}};return o[e](l,l.exports,r),l.exports}r.m=o,e=[],r.O=(o,t,s,l)=>{if(!t){var a=1/0;for(d=0;d<e.length;d++){for(var[t,s,l]=e[d],n=!0,i=0;i<t.length;i++)(!1&l||a>=l)&&Object.keys(r.O).every((e=>r.O[e](t[i])))?t.splice(i--,1):(n=!1,l<a&&(a=l));if(n){e.splice(d--,1);var c=s();void 0!==c&&(o=c)}}return o}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[t,s,l]},r.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),(()=>{var e={57:0,350:0};r.O.j=o=>0===e[o];var o=(o,t)=>{var s,l,[a,n,i]=t,c=0;if(a.some((o=>0!==e[o]))){for(s in n)r.o(n,s)&&(r.m[s]=n[s]);if(i)var d=i(r)}for(o&&o(t);c<a.length;c++)l=a[c],r.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return r.O(d)},t=globalThis.webpackChunkbestseller_block=globalThis.webpackChunkbestseller_block||[];t.forEach(o.bind(null,0)),t.push=o.bind(null,t.push.bind(t))})();var s=r.O(void 0,[350],(()=>r(306)));s=r.O(s)})();