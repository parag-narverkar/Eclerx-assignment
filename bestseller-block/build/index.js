(()=>{"use strict";const e=window.wp.blocks,t=window.wp.element,o=window.wp.blockEditor,s=window.wp.components,r=window.ReactJSXRuntime;(0,e.registerBlockType)("bestseller/block",{title:"Bestseller Block",category:"widgets",icon:"book",edit:e=>{const{attributes:a,setAttributes:l}=e,[n,c]=(0,t.useState)([]),[i,d]=(0,t.useState)([]),[g,h]=(0,t.useState)(!0),[u,p]=(0,t.useState)(!1),[w,k]=(0,t.useState)("desc");(0,t.useEffect)((()=>{fetch("https://api.penguinrandomhouse.com/resources/v2/title/domains/PRH.UK/categories?rows=15&catSetId=PW&api_key=7fqge2qgxcdrwqbcgeywwdj2").then((e=>e.json())).then((e=>{e.data&&Array.isArray(e.data.categories)?c(e.data.categories):console.error("Categories array not found in response."),h(!1)})).catch((e=>{console.error("Error fetching categories:",e),h(!1)}))}),[]);const y=(e,t="desc")=>{p(!0),fetch(`https://api.penguinrandomhouse.com/resources/v2/title/domains/PRH.UK/works/views/uk-list-display?catUri=${encodeURIComponent(e)}&sort=weeklySales&dir=${t}&api_key=7fqge2qgxcdrwqbcgeywwdj2`).then((e=>e.json())).then((e=>{e.data&&Array.isArray(e.data.works)?d(e.data.works):(console.error("Books array not found in response."),d([])),p(!1)})).catch((e=>{console.error("Error fetching books:",e),d([]),p(!1)}))},x=n.map((e=>({label:e.menuText,value:e.catUri}))),b=i.map((e=>({label:e.title,value:e.workId,coverUrl:e.coverUrls?.large?.coverUrl||""}))),j=i.find((e=>e.workId===parseInt(a.selectedBook)));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.InspectorControls,{children:(0,r.jsxs)(s.PanelBody,{title:"Category and Books Settings",initialOpen:!0,children:[g?(0,r.jsx)("p",{children:"Loading categories..."}):(0,r.jsx)(s.SelectControl,{label:"Select a Genre",value:a.selectedCategory||"",options:[{label:"Select a category",value:""},...x],onChange:e=>{l({selectedCategory:e});const t=n.find((t=>t.catUri===e))?.catUri;t&&y(t,w)}}),a.selectedCategory&&u?(0,r.jsx)("p",{children:"Loading books..."}):a.selectedCategory?(0,r.jsx)(s.SelectControl,{label:"Select a Book",value:a.selectedBook||"",options:[{label:"Select a book",value:""},...b],onChange:e=>{l({selectedBook:e})}}):null,(0,r.jsx)(s.SelectControl,{label:"Sort Order",value:w,options:[{label:"Descending (Most Sales First)",value:"desc"},{label:"Ascending (Least Sales First)",value:"asc"}],onChange:e=>{k(e),a.selectedCategory&&y(a.selectedCategory,e)}})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{children:"Selected Options"}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Genre:"})," ",a.selectedCategory?n.find((e=>e.catUri===a.selectedCategory))?.menuText||"Unknown":"None"]}),j?(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Book:"})," ",j.title]}),(0,r.jsx)("img",{src:j.coverUrls?.large?.coverUrl||"",alt:j.title,style:{maxWidth:"200px",height:"auto"}})]}):(0,r.jsx)("p",{children:"No book selected"})]})]})},save:()=>null})})();