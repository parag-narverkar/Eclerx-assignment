(()=>{"use strict";const e=window.wp.blocks,t=window.wp.element,o=window.wp.blockEditor,s=window.wp.components,r=window.ReactJSXRuntime;(0,e.registerBlockType)("my-block/category-book-selector",{title:"Bestseller Block",category:"widgets",icon:"book",attributes:{selectedCategory:{type:"string",default:""},selectedBook:{type:"string",default:""},selectedBookCover:{type:"string",default:""}},edit:e=>{const{attributes:l,setAttributes:a}=e,[n,c]=(0,t.useState)([]),[i,d]=(0,t.useState)([]),[g,h]=(0,t.useState)(!0),[u,p]=(0,t.useState)(!1),[y,k]=(0,t.useState)("desc");(0,t.useEffect)((()=>{fetch("https://api.penguinrandomhouse.com/resources/v2/title/domains/PRH.UK/categories?rows=15&catSetId=PW&api_key=7fqge2qgxcdrwqbcgeywwdj2").then((e=>e.json())).then((e=>{e.data&&Array.isArray(e.data.categories)?c(e.data.categories):console.error("Categories array not found in response."),h(!1)})).catch((e=>{console.error("Error fetching categories:",e),h(!1)}))}),[]),(0,t.useEffect)((()=>{l.selectedCategory&&w(l.selectedCategory,y)}),[l.selectedCategory,y]);const w=(e,t="desc")=>{p(!0),fetch(`https://api.penguinrandomhouse.com/resources/v2/title/domains/PRH.UK/works/views/uk-list-display?catUri=${encodeURIComponent(e)}&sort=weeklySales&dir=${t}&api_key=7fqge2qgxcdrwqbcgeywwdj2`).then((e=>e.json())).then((e=>{e.data&&Array.isArray(e.data.works)?d(e.data.works):(console.error("Books array not found in response."),d([])),p(!1)})).catch((e=>{console.error("Error fetching books:",e),d([]),p(!1)}))},x=n.map((e=>({label:e.menuText,value:e.catUri}))),j=i.map((e=>({label:e.title,value:e.workId}))),C=i.find((e=>e.workId===parseInt(l.selectedBook)));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.InspectorControls,{children:(0,r.jsxs)(s.PanelBody,{title:"Category and Books Settings",initialOpen:!0,children:[g?(0,r.jsx)("p",{children:"Loading categories..."}):(0,r.jsx)(s.SelectControl,{label:"Select a Genre",value:l.selectedCategory||"",options:[{label:"Select a category",value:""},...x],onChange:e=>{a({selectedCategory:e});const t=n.find((t=>t.catUri===e))?.catUri;t&&w(t,y)}}),l.selectedCategory&&u?(0,r.jsx)("p",{children:"Loading books..."}):l.selectedCategory?(0,r.jsx)(s.SelectControl,{label:"Select a Book",value:l.selectedBook||"",options:[{label:"Select a book",value:""},...j],onChange:e=>{const t=i.find((t=>t.workId===parseInt(e)));a({selectedBook:e,selectedBookCover:t?.coverUrls?.large?.coverUrl||""})}}):null,(0,r.jsx)(s.SelectControl,{label:"Sort Order",value:y,options:[{label:"Descending (Most Sales First)",value:"desc"},{label:"Ascending (Least Sales First)",value:"asc"}],onChange:e=>{k(e),l.selectedCategory&&w(l.selectedCategory,e)}})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{children:"Selected Options"}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Genre:"})," ",l.selectedCategory?n.find((e=>e.catUri===l.selectedCategory))?.menuText||"Unknown":"None"]}),C?(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Book:"})," ",C.title]}),(0,r.jsx)("img",{src:C.coverUrls?.large?.coverUrl||"",alt:C.title,style:{maxWidth:"200px",height:"auto"}})]}):(0,r.jsx)("p",{children:"No book selected"})]})]})},save:({attributes:e})=>{const{selectedCategory:t,selectedBookCover:o}=e;return(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Selected Genre:"})," ",t||"None"]}),o?(0,r.jsx)("img",{src:o,alt:"Selected Book Cover",style:{maxWidth:"200px",height:"auto"}}):(0,r.jsx)("p",{children:(0,r.jsx)("strong",{children:"No book cover selected."})})]})}})})();